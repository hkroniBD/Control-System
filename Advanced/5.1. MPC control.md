
# Lecture: Introduction to Model Predictive Control (MPC)

## 1. Introduction to MPC
- **What is MPC?**
  - Model Predictive Control is an advanced control strategy that uses a model of the system to predict future behavior and optimize control actions over a finite time horizon.
  - Unlike traditional control (e.g., PID), MPC explicitly considers system constraints and optimizes performance based on a defined objective.
  - Key idea: At each control step, MPC solves an optimization problem to determine the best control inputs, applies the first input, and repeats the process at the next step (receding horizon).

- **Why MPC?**
  - Handles multivariable systems, constraints (e.g., actuator limits), and complex dynamics effectively.
  - Optimizes performance based on a cost function (e.g., minimizing error, energy use).
  - Widely used in industries like chemical plants, automotive, aerospace, and robotics.

## 2. Core Components of MPC
- **System Model**:
  - A mathematical model (linear or nonlinear) describes the system dynamics.
  - Common forms: State-space, transfer function, or differential equations.
  - Example (linear state-space model):
    \[
    x(k+1) = Ax(k) + Bu(k), \quad y(k) = Cx(k)
    \]
    where \(x(k)\) is the state, \(u(k)\) is the input, \(y(k)\) is the output, and \(A\), \(B\), \(C\) are system matrices.

- **Cost Function**:
  - Defines the control objective, typically minimizing tracking error and control effort.
  - Example:
    \[
    J = \sum_{i=1}^{N_p} \|y(k+i) - r(k+i)\|_Q^2 + \sum_{i=0}^{N_c-1} \|u(k+i)\|_R^2
    \]
    where \(N_p\) is the prediction horizon, \(N_c\) is the control horizon, \(r(k)\) is the reference, and \(Q\), \(R\) are weighting matrices for output error and control effort, respectively.

- **Constraints**:
  - Physical limits on inputs, states, or outputs (e.g., \(u_{\text{min}} \leq u(k) \leq u_{\text{max}}\)).
  - Ensures safe and feasible operation.

- **Optimization**:
  - At each time step, MPC solves a constrained optimization problem to find the optimal sequence of control inputs.
  - Only the first control input is applied, and the process repeats (receding horizon).

## 3. How MPC Works
- **Steps in MPC**:
  1. **Predict**: Use the system model to predict future outputs over a prediction horizon \(N_p\).
  2. **Optimize**: Solve an optimization problem to minimize the cost function subject to constraints.
  3. **Apply**: Implement the first control input from the optimal sequence.
  4. **Update**: Measure the system state/output, update the model, and repeat at the next time step.

- **Receding Horizon Principle**:
  - Continuously shifts the prediction and control horizons forward, allowing real-time adaptation to disturbances and model mismatches.

## 4. Mathematical Formulation
- **Standard MPC Problem**:
  \[
  \min_{u(k), \dots, u(k+N_c-1)} J = \sum_{i=1}^{N_p} \|y(k+i) - r(k+i)\|_Q^2 + \sum_{i=0}^{N_c-1} \|u(k+i)\|_R^2
  \]
  Subject to:
  - System dynamics: \(x(k+i+1) = Ax(k+i) + Bu(k+i)\)
  - Constraints: \(u_{\text{min}} \leq u(k+i) \leq u_{\text{max}}\), \(y_{\text{min}} \leq y(k+i) \leq y_{\text{max}}\)
  - Terminal conditions (optional, for stability).

- **Solution**:
  - For linear systems with quadratic costs, solved via quadratic programming (QP).
  - For nonlinear systems, requires nonlinear optimization (e.g., sequential quadratic programming).

## 5. Advantages of MPC
- **Handles Constraints**: Explicitly incorporates input, state, and output constraints.
- **Multivariable Control**: Manages interactions in multi-input, multi-output systems.
- **Predictive Nature**: Anticipates future behavior, improving performance for systems with delays or slow dynamics.
- **Flexibility**: Can optimize for various objectives (e.g., energy efficiency, tracking accuracy).

## 6. Challenges and Limitations
- **Computational Complexity**: Solving optimization problems in real-time can be demanding, especially for nonlinear systems or long horizons.
- **Model Dependency**: Performance relies on the accuracy of the system model; model mismatches can degrade control quality.
- **Tuning**: Selecting appropriate horizons (\(N_p\), \(N_c\)) and weights (\(Q\), \(R\)) requires expertise.
- **Scalability**: Large systems with many variables increase computational burden.

## 7. Practical Applications
- **Chemical Process Control**: Regulating temperature, pressure, and flow in reactors and distillation columns.
- **Automotive**: Engine control, autonomous vehicle path planning, and battery management in electric vehicles.
- **Aerospace**: Flight control systems and satellite attitude control.
- **Robotics**: Trajectory tracking and obstacle avoidance.
- **Energy Systems**: Optimizing power generation and distribution in smart grids.

## 8. Implementation Considerations
- **Modeling**: Develop an accurate yet computationally efficient model (e.g., linearize nonlinear systems if possible).
- **Real-Time Optimization**: Use efficient solvers (e.g., QP solvers for linear MPC, or fast gradient methods).
- **Robustness**: Incorporate uncertainty handling (e.g., robust MPC or stochastic MPC) for disturbances or model errors.
- **Software Tools**:
  - MATLAB (MPC Toolbox), Python (e.g., `do-mpc`, `GEKKO`).
  - Industrial platforms: Honeywell Profit Controller, AspenTech DMCplus.

## 9. Example: Temperature Control in a Reactor
- **System**: A chemical reactor with temperature as the controlled variable, heater power as the input, and constraints on maximum heater power.
- **Model**: Linear state-space model derived from first principles or system identification.
- **Objective**: Track a desired temperature profile while minimizing energy use.
- **MPC Setup**:
  - Prediction horizon: \(N_p = 10\), control horizon: \(N_c = 3\).
  - Constraints: \(0 \leq u \leq 100 \, \text{kW}\), temperature within safe limits.
  - Cost function: Penalize temperature error and excessive heater power.
- **Result**: MPC computes optimal heater power sequence, applies the first input, and adjusts based on real-time temperature measurements.

## 10. Conclusion
- MPC is a powerful control strategy that combines prediction, optimization, and constraint handling for complex systems.
- Its ability to handle multivariable systems and constraints makes it ideal for industrial and engineering applications.
- Challenges include computational demands and model accuracy, but advances in algorithms and computing power are making MPC more accessible.
- Future trends: Integration with machine learning for adaptive models, distributed MPC for large-scale systems, and real-time embedded implementations.

## 11. Further Reading
- Books:
  - "Model Predictive Control" by E.F. Camacho and C. Bordons.
  - "Predictive Control for Linear and Hybrid Systems" by F. Borrelli et al.
- Tools: Explore MATLAB MPC Toolbox, Pythonâ€™s `do-mpc`, or open-source libraries like `CasADi`.
- Research: Look into robust MPC, nonlinear MPC, and learning-based MPC for cutting-edge developments.

---