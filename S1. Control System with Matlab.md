# 🎛️ Control Systems with MATLAB Programming
## Electrical Engineering Applications

---

## 📚 **Lecture Overview**

This comprehensive lecture focuses on practical implementation of control systems using MATLAB, with emphasis on electrical engineering applications including motor drives, power systems, and power electronics. We'll explore both classical and modern control techniques through hands-on programming examples.

### 🎯 **Learning Objectives**
- Master MATLAB Control System Toolbox functions
- Implement control algorithms for electrical systems
- Design and analyze controllers for motors and power converters
- Develop simulation models for real-world applications
- Apply frequency and time domain analysis techniques

### 🛠️ **Required MATLAB Toolboxes**
```matlab
% Essential toolboxes for this lecture
% - Control System Toolbox
% - Simulink
% - Power System Toolbox (optional)
% - DSP System Toolbox (for digital control)

% Check toolbox availability
ver
```

---

## 🧩 **Problem Statement: DC Motor Speed Control**

**Design Challenge:** A DC motor used in an industrial conveyor system needs precise speed control. The motor has significant inertia and experiences variable load disturbances. Design a control system that maintains constant speed despite load variations, with less than 5% overshoot and settling time under 2 seconds.

---

## 🏗️ **Part 1: MATLAB Control System Fundamentals**

### 📊 **1.1 Creating Transfer Functions**

**Problem Statement:** Model an RC low-pass filter circuit and analyze its frequency response characteristics.

```matlab
%% RC Circuit Transfer Function - Classroom Example
% Simple RC filter analysis for beginners

% Circuit parameters
R = 1000;    % 1kΩ resistance (try changing this value!)
C = 1e-6;    % 1µF capacitance

% Create transfer function using different methods
s = tf('s');                    % Define Laplace variable
H_rc = 1/(R*C*s + 1);          % RC circuit transfer function

% Alternative method using coefficients
num = 1;
den = [R*C, 1];                % [τ, 1] where τ = R*C
H_rc_alt = tf(num, den);

% Display and compare
disp('RC Circuit Transfer Functions:')
H_rc
H_rc_alt

% Quick analysis
dc_gain = dcgain(H_rc);
cutoff_freq = 1/(2*pi*R*C);
fprintf('DC Gain: %.2f\n', dc_gain);
fprintf('Cutoff Frequency: %.2f Hz\n', cutoff_freq);
```

### ⚡ **1.2 DC Motor Transfer Function**

**Problem Statement:** Model a DC motor and identify its key dynamic characteristics for control design.

```matlab
%% Simplified DC Motor Model - Classroom Example
% Perfect for introductory control classes

% Motor parameters (typical educational motor)
J = 0.01;      % Moment of inertia
b = 0.1;       % Damping coefficient  
K = 0.01;      % Motor constant
R = 1;         % Armature resistance
L = 0.5;       % Armature inductance

% Create transfer function from voltage to speed
s = tf('s');
numerator = K;
denominator = [J*L, J*R + b*L, b*R + K^2, 0];

G_motor = tf(numerator, denominator);

disp('DC Motor Transfer Function:')
G_motor

% Quick analysis for students
poles = pole(G_motor);
dc_gain_motor = dcgain(G_motor);
fprintf('DC Gain: %.3f rad/s/V\n', dc_gain_motor);
fprintf('System Poles:\n');
disp(poles);
```

---

## 📈 **Part 2: Time Domain Analysis**

### ⏱️ **2.1 Step Response Analysis**

**Problem Statement:** Analyze the step response of our DC motor and determine if it meets basic performance requirements.

```matlab
%% Step Response Analysis - Classroom Example
% Perfect for visualizing system dynamics

figure('Position', [100, 100, 800, 600]);

% Step response of DC motor
subplot(2,1,1)
step(G_motor);
title('DC Motor Step Response');
grid on;

% Get performance metrics
motor_info = stepinfo(G_motor);
fprintf('Rise Time: %.2f seconds\n', motor_info.RiseTime);
fprintf('Settling Time: %.2f seconds\n', motor_info.SettlingTime);
fprintf('Overshoot: %.1f%%\n', motor_info.Overshoot);

% Compare with RC circuit
subplot(2,1,2)
step(H_rc);
title('RC Circuit Step Response');
grid on;

rc_info = stepinfo(H_rc);
fprintf('\nRC Circuit - Rise Time: %.4f seconds\n', rc_info.RiseTime);
```

### 🎚️ **2.2 System Response to Different Inputs**

**Problem Statement:** How does our motor respond to different types of input signals encountered in real applications?

```matlab
%% Multiple Input Responses - Classroom Example
% Compare different input types

t = 0:0.01:5;  % Time vector

figure('Position', [150, 150, 1200, 400]);

% Impulse response (sudden torque disturbance)
subplot(1,3,1)
impulse(G_motor);
title('Response to Impulse (Disturbance)');
grid on;

% Ramp response (gradual speed increase)
subplot(1,3,2)
ramp_response = step(G_motor/s, t);
plot(t, ramp_response);
title('Response to Ramp Input');
xlabel('Time (s)');
ylabel('Position (rad)');
grid on;

% Sinusoidal response (vibration analysis)
subplot(1,3,3)
u = sin(2*pi*1*t);  % 1 Hz sine wave
lsim(G_motor, u, t);
title('Response to Sinusoidal Input');
grid on;
```

---

## 🌊 **Part 3: Frequency Domain Analysis**

### 📊 **3.1 Bode Plots for Stability Analysis**

**Problem Statement:** Analyze the frequency response of our motor to determine stability margins and bandwidth.

```matlab
%% Bode Plot Analysis - Classroom Example
% Essential for understanding system stability

figure('Position', [200, 200, 1000, 800]);

% Bode plot with stability margins
subplot(2,1,1)
margin(G_motor);
title('DC Motor Bode Plot with Stability Margins');
grid on;

% Get stability metrics
[Gm, Pm, Wcg, Wcp] = margin(G_motor);
fprintf('Gain Margin: %.2f dB at %.2f rad/s\n', 20*log10(Gm), Wcg);
fprintf('Phase Margin: %.2f° at %.2f rad/s\n', Pm, Wcp);

% Compare with RC circuit
subplot(2,1,2)
bode(H_rc);
title('RC Circuit Bode Plot');
grid on;
```

### 📈 **3.2 Custom Frequency Analysis**

**Problem Statement:** Determine the bandwidth and resonant frequencies of our system for controller design.

```matlab
%% Custom Frequency Analysis - Classroom Example
% Hands-on frequency response plotting

w = logspace(-1, 3, 500);  % Frequency range: 0.1 to 1000 rad/s

[mag, phase] = bode(G_motor, w);
mag = squeeze(mag);  % Remove extra dimensions

figure('Position', [250, 250, 1000, 400]);

% Magnitude plot
subplot(1,2,1)
semilogx(w, 20*log10(mag), 'b-', 'LineWidth', 2);
title('Motor Frequency Response');
ylabel('Magnitude (dB)');
grid on;

% Find -3dB point
[~, idx] = min(abs(20*log10(mag) + 3));
bandwidth = w(idx);
fprintf('System Bandwidth: %.2f rad/s (%.2f Hz)\n', bandwidth, bandwidth/(2*pi));
xline(bandwidth, '--r', 'Bandwidth');

% Phase plot
subplot(1,2,2)
semilogx(w, squeeze(phase), 'r-', 'LineWidth', 2);
ylabel('Phase (degrees)');
xlabel('Frequency (rad/s)');
grid on;
```

---

## 🎨 **Part 4: Controller Design**

### 🎛️ **4.1 PID Controller Implementation**

**Problem Statement:** Design a PID controller to improve the motor's response time and reduce overshoot.

```matlab
%% PID Controller Design - Classroom Example
% Practical PID implementation for motor control

% Initial motor response (for comparison)
figure('Position', [300, 300, 1000, 400]);

subplot(1,2,1)
step(G_motor);
title('Open-Loop Response');
grid on;

% PID controller design
Kp = 10;   % Proportional gain
Ki = 5;    % Integral gain
Kd = 0.1;  % Derivative gain

C_pid = pid(Kp, Ki, Kd);

% Closed-loop system
T_pid = feedback(C_pid * G_motor, 1);

subplot(1,2,2)
step(T_pid);
title('Closed-Loop with PID');
grid on;

% Performance comparison
open_info = stepinfo(G_motor);
closed_info = stepinfo(T_pid);

fprintf('Open-loop Settling Time: %.2f s\n', open_info.SettlingTime);
fprintf('Closed-loop Settling Time: %.2f s\n', closed_info.SettlingTime);
fprintf('Improvement: %.1f%%\n', (open_info.SettlingTime - closed_info.SettlingTime)/open_info.SettlingTime*100);
```

### 🔧 **4.2 Automatic PID Tuning**

**Problem Statement:** Use MATLAB's automatic tuning capabilities to optimize our PID controller.

```matlab
%% Automatic PID Tuning - Classroom Example
% Let MATLAB find the optimal PID parameters

% Use pidtune function for automatic optimization
C_auto = pidtune(G_motor, 'PID');

% Display tuned parameters
disp('Auto-tuned PID Controller:');
C_auto

% Compare responses
T_auto = feedback(C_auto * G_motor, 1);

figure('Position', [350, 350, 800, 400]);
step(T_pid, 'b-', T_auto, 'r--');
legend('Manual PID', 'Auto-tuned PID');
title('PID Tuning Comparison');
grid on;

% Analyze performance
auto_info = stepinfo(T_auto);
fprintf('Auto-tuned Overshoot: %.1f%%\n', auto_info.Overshoot);
fprintf('Auto-tuned Settling Time: %.2f s\n', auto_info.SettlingTime);
```

---

## ⚡ **Part 5: Electrical Applications**

### 🔄 **5.1 Motor Control Implementation**

**Problem Statement:** Implement a complete speed control system for our DC motor with disturbance rejection.

```matlab
%% Complete Motor Control System - Classroom Example
% Practical implementation with disturbance analysis

% Design a better controller
C_optimized = pidtune(G_motor, 'PIDF');  % PID with filter

% Closed-loop system
T_optimal = feedback(C_optimized * G_motor, 1);

% Test disturbance rejection
t = 0:0.01:10;
u = ones(size(t));  % Step input

% Add disturbance at t=5 seconds
disturbance = zeros(size(t));
disturbance(t >= 5) = -0.5;  % Load disturbance

% Simulate response
y = lsim(T_optimal, u + disturbance, t);

figure('Position', [400, 400, 1000, 400]);
plot(t, u, 'g--', t, disturbance, 'r-.', t, y, 'b-', 'LineWidth', 2);
legend('Reference', 'Disturbance', 'Actual Speed');
title('Motor Control with Disturbance Rejection');
xlabel('Time (s)');
ylabel('Speed (rad/s)');
grid on;

% Calculate disturbance rejection performance
steady_state_error = abs(1 - y(end));
fprintf('Steady-state error after disturbance: %.3f rad/s\n', steady_state_error);
```

### 🔌 **5.2 Power Converter Control**

**Problem Statement:** Design a controller for a buck converter to maintain constant output voltage.

```matlab
%% Buck Converter Control - Classroom Example
% Simplified power electronics control

% Buck converter parameters
Vin = 24;       % Input voltage
Vout = 12;      % Output voltage
L = 100e-6;     % Inductance
C = 470e-6;     % Capacitance
R = 5;          % Load resistance

% Transfer function: Gvd(s) = Vout/(LCs² + (L/R)s + 1)
s = tf('s');
G_converter = Vout / (L*C*s^2 + (L/R)*s + 1);

% Design controller
C_conv = pidtune(G_converter, 'PID');

% Closed-loop system
T_conv = feedback(C_conv * G_converter, 1);

% Analysis
figure('Position', [450, 450, 1200, 400]);

subplot(1,2,1)
step(T_conv);
title('Buck Converter Step Response');
grid on;

subplot(1,2,2)
bode(T_conv);
title('Closed-Loop Frequency Response');
grid on;

% Check performance
conv_info = stepinfo(T_conv);
fprintf('Converter Settling Time: %.3f seconds\n', conv_info.SettlingTime);
fprintf('Converter Overshoot: %.1f%%\n', conv_info.Overshoot);
```

---

## 🔬 **Part 6: Advanced Analysis Techniques**

### 📊 **6.1 Root Locus Analysis**

**Problem Statement:** Use root locus techniques to analyze how controller gains affect system stability.

```matlab
%% Root Locus Analysis - Classroom Example
% Visualizing how poles move with gain changes

figure('Position', [500, 500, 1000, 400]);

% Root locus of motor
subplot(1,2,1)
rlocus(G_motor);
title('DC Motor Root Locus');
grid on;

% Root locus with controller
subplot(1,2,2)
rlocus(C_pid * G_motor);
title('System Root Locus with PID');
grid on;

% Find gain for specific damping ratio
zeta = 0.707;  % Desired damping ratio
[K, poles] = rlocfind(C_pid * G_motor);
fprintf('Gain for ζ=0.707: %.2f\n', K);
```

### 🎯 **6.2 State-Space Analysis**

**Problem Statement:** Convert our system to state-space form and analyze controllability and observability.

```matlab
%% State-Space Analysis - Classroom Example
% Modern control theory fundamentals

% Convert to state-space
[A, B, C, D] = tf2ss(G_motor.Numerator{1}, G_motor.Denominator{1});
sys_ss = ss(A, B, C, D);

disp('State-Space Representation:');
sys_ss

% Check controllability and observability
Co = ctrb(A, B);
Ob = obsv(A, C);

fprintf('Controllability Matrix Rank: %d\n', rank(Co));
fprintf('Observability Matrix Rank: %d\n', rank(Ob));

if rank(Co) == size(A, 1)
    fprintf('System is Controllable\n');
else
    fprintf('System is NOT Controllable\n');
end

if rank(Ob) == size(A, 1)
    fprintf('System is Observable\n');
else
    fprintf('System is NOT Observable\n');
end
```

---

## 🧪 **Hands-On Exercises**

### Exercise 1: PID Tuning Practice
```matlab
%% Exercise 1: Manual PID Tuning
% Try different PID values and observe the effects

% Test these different controller configurations:
% 1. P-only control: Kp = 5, Ki = 0, Kd = 0
% 2. PI control: Kp = 5, Ki = 2, Kd = 0  
% 3. PID control: Kp = 10, Ki = 5, Kd = 0.1
% 4. Your own values: experiment!

% Compare step responses and document your findings
```

### Exercise 2: System Identification
```matlab
%% Exercise 2: Estimate System Parameters
% From step response data, estimate motor parameters

% Use step response data to find:
% 1. Time constant (τ)
% 2. DC gain (K)
% 3. Damping ratio (ζ) if applicable

% Compare your estimates with the actual parameters
```

### Exercise 3: Controller Design Challenge
```matlab
%% Exercise 3: Design a Controller for These Specifications
% Design requirements:
% - Overshoot < 2%
% - Settling time < 1.5 seconds  
% - Steady-state error < 1%

% Try different controller types:
% 1. Lead compensator
% 2. PID controller
% 3. State feedback

% Document which works best and why
```

---

## 📝 **Conclusion and Next Steps**

This lecture provided a comprehensive introduction to control systems with MATLAB, focusing on practical electrical engineering applications. We've covered:

- **System modeling** with transfer functions and state-space representations
- **Time and frequency domain analysis** for understanding system behavior
- **Controller design** using both classical and modern techniques
- **Real-world applications** in motor control and power electronics

### 🔮 **Further Learning Path:**
1. Digital control implementation with discrete controllers
2. Nonlinear control techniques for power electronics
3. Adaptive and robust control methods
4. Hardware-in-the-loop testing
5. Machine learning applications in control systems

### 📚 **Recommended Resources:**
- MATLAB Control System Toolbox documentation
- "Modern Control Engineering" by Katsuhiko Ogata
- "Feedback Control of Dynamic Systems" by Franklin, Powell, and Emami-Naeini
- MATLAB Onramp and Control Design Onramp courses

```matlab
%% Final Check: Verify Your Understanding
% Run this code to test your basic understanding

% Create a simple first-order system
tau = 0.5;  % Time constant
G = tf(1, [tau, 1]);

% Check your knowledge:
fprintf('System time constant: %.2f seconds\n', tau);
fprintf('Rise time (approx): %.2f seconds\n', 2.2*tau);
fprintf('Settling time (2%%): %.2f seconds\n', 4*tau);
fprintf('Cutoff frequency: %.2f rad/s\n', 1/tau);
```

**Remember:** Control system design is both an art and a science. Practice with different systems and continue exploring MATLAB's powerful control design capabilities!
