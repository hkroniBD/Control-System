# Resonant Controllers: Theory and MATLAB Implementation

## Learning Objectives
By the end of this lecture, students will be able to:
- Understand the principles and applications of resonant controllers
- Design resonant controllers for specific frequencies
- Implement resonant controllers in MATLAB/Simulink
- Analyze the performance of resonant control systems
- Apply resonant controllers to practical engineering problems

## 1. Introduction to Resonant Controllers

### What is a Resonant Controller?
A resonant controller is a specialized control technique designed to track sinusoidal reference signals or reject sinusoidal disturbances at specific frequencies with **zero steady-state error**. Unlike conventional PI/PID controllers, resonant controllers provide infinite gain at the resonant frequency, making them ideal for applications involving periodic signals.

### Key Characteristics:
- **Infinite gain** at resonant frequency ω₀
- **Zero steady-state error** for sinusoidal inputs at ω₀
- **Narrow bandwidth** around the resonant frequency
- **Selective frequency response**

## 2. Mathematical Foundation

### Basic Resonant Controller Transfer Function
The ideal resonant controller has the transfer function:

```
C_R(s) = K_r * (2ω_c * s) / (s² + 2ω_c*s + ω₀²)
```

Where:
- `K_r`: Resonant gain
- `ω₀`: Resonant frequency (rad/s)
- `ω_c`: Bandwidth parameter (determines the width of resonance)

### Alternative Form (Pure Resonant):
```
C_R(s) = K_r * s / (s² + ω₀²)
```

This form provides infinite gain exactly at ω₀ but may cause stability issues.

### Internal Model Principle
The resonant controller embeds a model of the exosystem (sinusoidal disturbance/reference) within the controller structure. This follows the **Internal Model Principle**, which states that perfect tracking/rejection requires the controller to contain a model of the signals to be tracked/rejected.

## 3. Design Methodology

### Step 1: Identify Target Frequencies
Determine the frequencies where perfect tracking or disturbance rejection is required:
- Fundamental frequency of reference/disturbance
- Significant harmonic frequencies

### Step 2: Choose Controller Parameters
- **Resonant frequency (ω₀)**: Set to target frequency
- **Resonant gain (K_r)**: Determines controller authority
- **Bandwidth (ω_c)**: Controls robustness vs. selectivity trade-off

### Step 3: Stability Analysis
Ensure closed-loop stability using:
- Root locus analysis
- Nyquist stability criterion
- Gain/phase margins

## 4. MATLAB Implementation Examples

### Example 1: Basic Resonant Controller Design

```matlab
% System parameters
s = tf('s');
ω0 = 50;  % Resonant frequency (rad/s)
Kr = 100; % Resonant gain
ωc = 5;   % Bandwidth parameter

% Design resonant controller
Cr = Kr * (2*ωc*s) / (s^2 + 2*ωc*s + ω0^2);

% Plant (example: second-order system)
G = 1000 / (s^2 + 20*s + 1000);

% Closed-loop system
T = feedback(Cr*G, 1);

% Frequency response
figure;
bode(Cr);
title('Resonant Controller Frequency Response');
grid on;

% Step response
figure;
step(T);
title('Closed-loop Step Response');
grid on;
```

### Example 2: Multiple Resonant Controllers (Harmonic Control)

```matlab
% Design controller for fundamental and harmonics
ω_fundamental = 2*pi*50;  % 50 Hz fundamental
harmonics = [1, 3, 5, 7]; % Harmonic orders
Kr = [1000, 500, 200, 100]; % Gains for each harmonic
ωc = 2*pi*2; % 2 Hz bandwidth

% Create individual resonant controllers
Cr_total = 0;
for i = 1:length(harmonics)
    ω0 = harmonics(i) * ω_fundamental;
    Cr_harmonic = Kr(i) * (2*ωc*s) / (s^2 + 2*ωc*s + ω0^2);
    Cr_total = Cr_total + Cr_harmonic;
end

% Add proportional gain for stability
Kp = 10;
C_total = Kp + Cr_total;

% Frequency response
figure;
bode(C_total);
title('Multi-Harmonic Resonant Controller');
grid on;
```

### Example 3: Resonant Controller with PI Base

```matlab
% Combined PI + Resonant controller
Kp = 50;
Ki = 500;
PI_controller = pid(Kp, Ki, 0);

% Resonant part
ω0 = 100;  % rad/s
Kr = 200;
ωc = 5;
Resonant_part = Kr * (2*ωc*s) / (s^2 + 2*ωc*s + ω0^2);

% Combined controller
C_PIR = PI_controller + Resonant_part;

% Analysis
figure;
bode(C_PIR);
title('PI + Resonant Controller');
grid on;
```

## 5. Practical Applications

### Power Electronics
- **Grid-tied inverters**: Tracking sinusoidal current references
- **Active power filters**: Rejecting harmonic disturbances
- **UPS systems**: Maintaining sinusoidal output voltage

### Vibration Control
- **Active suspension**: Rejecting periodic road disturbances
- **Machine tool control**: Eliminating spindle vibrations
- **Structural control**: Attenuating building oscillations

### Motor Drives
- **AC motor control**: Torque ripple minimization
- **Direct torque control**: Smooth torque production
- **Position control**: Tracking periodic position profiles

## 6. Design Considerations and Trade-offs

### Stability vs. Performance
- **Narrow bandwidth (small ωc)**: Better selectivity but less robust
- **Wide bandwidth (large ωc)**: More robust but less selective

### Computational Complexity
- Multiple resonant controllers increase computational load
- Consider implementation constraints in real-time systems

### Parameter Sensitivity
- Frequency variations affect performance
- Adaptive tuning may be necessary for varying conditions

## 7. Advanced Topics

### Adaptive Resonant Control
Automatically adjust ω₀ based on measured frequency:

```matlab
% Example: Frequency estimation and adaptation
% (This would typically involve online estimation algorithms)
estimated_freq = 50.5; % Hz (estimated from measurements)
ω0_adaptive = 2*pi*estimated_freq;

% Update controller
Cr_adaptive = Kr * (2*ωc*s) / (s^2 + 2*ωc*s + ω0_adaptive^2);
```

### Discrete-Time Implementation
For digital control systems:

```matlab
% Convert to discrete-time
Ts = 1e-4; % Sampling time (100 μs)
Cr_discrete = c2d(Cr, Ts, 'tustin');

% Implement using difference equations
[num, den] = tfdata(Cr_discrete, 'v');
```

## 8. Simulation Example: Grid-Connected Inverter

```matlab
% Complete simulation example
clear; clc; close all;

% System parameters
Ts = 50e-6;    % 20 kHz switching frequency
f_grid = 50;   % Grid frequency (Hz)
ω_grid = 2*pi*f_grid;

% Plant model (LCL filter)
L1 = 2e-3; L2 = 1e-3; C = 10e-6; % Filter parameters
R1 = 0.1; R2 = 0.05;             % Resistances

% Create plant transfer function (simplified)
s = tf('s');
G_plant = 1 / (L1*L2*C*s^3 + (R1*L2*C + R2*L1*C)*s^2 + (L1+L2)*s + (R1+R2));

% Design resonant controller
Kr = 1000;
ωc = 2*pi*5; % 5 Hz bandwidth
Cr = Kr * (2*ωc*s) / (s^2 + 2*ωc*s + ω_grid^2);

% Add proportional gain
Kp = 10;
C_total = Kp + Cr;

% Closed-loop system
T_cl = feedback(C_total * G_plant, 1);

% Simulation
t = 0:Ts:0.1; % 100 ms simulation
reference = sin(ω_grid * t); % Sinusoidal reference

% Response
[y, t_sim] = lsim(T_cl, reference, t);

% Plot results
figure;
subplot(2,1,1);
plot(t, reference, 'r--', 'LineWidth', 2);
hold on;
plot(t_sim, y, 'b-', 'LineWidth', 1.5);
xlabel('Time (s)');
ylabel('Amplitude');
title('Reference Tracking Performance');
legend('Reference', 'Output', 'Location', 'best');
grid on;

subplot(2,1,2);
plot(t, reference - y(1:length(t)));
xlabel('Time (s)');
ylabel('Error');
title('Tracking Error');
grid on;
```

## 9. Performance Metrics

### Steady-State Error
For sinusoidal inputs at resonant frequency:
```
e_ss = 0 (ideal resonant controller)
```

### Transient Response
- Settling time depends on controller bandwidth
- May exhibit oscillatory behavior during transients

### Frequency Domain Metrics
- Gain margin
- Phase margin
- Sensitivity function analysis

## 10. Laboratory Exercise

### Objective
Design and implement a resonant controller for a given system with sinusoidal disturbance rejection requirements.

### Tasks
1. Analyze the given plant transfer function
2. Identify disturbance frequencies
3. Design appropriate resonant controllers
4. Simulate closed-loop performance
5. Compare with conventional PI control
6. Analyze robustness to frequency variations

## Summary

Resonant controllers provide an elegant solution for tracking sinusoidal references and rejecting periodic disturbances. Key takeaways:

- **Perfect tracking/rejection** at resonant frequencies
- **Internal model principle** governs design philosophy  
- **Stability analysis** is crucial for successful implementation
- **Multiple resonant controllers** can handle harmonic content
- **Wide applications** in power electronics, vibration control, and motor drives
- **Trade-offs** exist between performance, robustness, and complexity

The MATLAB examples provided demonstrate practical implementation techniques and serve as a foundation for more advanced applications.

## References and Further Reading

1. Yepes, A.G., et al. "Effects of discretization methods on the performance of resonant controllers." IEEE Transactions on Power Electronics (2010).

2. Zmood, D.N., and Holmes, D.G. "Stationary frame current regulation of PWM inverters with zero steady-state error." IEEE Transactions on Power Electronics (2003).

3. Francis, B.A., and Wonham, W.M. "The internal model principle of control theory." Automatica (1976).

4. Teodorescu, R., et al. "Proportional-resonant controllers and filters for grid-connected voltage-source converters." IEE Proceedings-Electric Power Applications (2006).
